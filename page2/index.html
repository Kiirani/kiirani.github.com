<!DOCTYPE HTML>

<html>

<head>
	<title>kiirani.com - blag</title>

	<link rel="stylesheet" type="text/css" href="/styles/site.css">
	<link rel="stylesheet" type="text/css" href="/styles/syntax.css">
	<link rel="stylesheet" type="text/css" href="/styles/gist.css">

	<link rel="alternate" type="application/rss+xml" title="kiirani.com rss feed" href="/feed.xml">

	<meta name="viewport" content="width=640" />

</head>

<body>
<div id="h4x"></div>

<h1 id="main-header">
	<a href="/">kiirani.com / blag</a>

</h1>

<nav id="main-nav">
	<ul id="site-pages">
	
		
		
		
		
	
		
		
		
		<li> <a href="/about.html">about</a> </li>
		
		
	
		
		
		
		<li> <a href="/archive.html">archive</a> </li>
		
		
	
		
		
		
		<li> <a href="/index.html">blag</a> </li>
		
		
	
		
		
	
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
		
		
		
		
	
	</ul>

	
<h2>find kiirani</h2>
<ul>
	<li><a href="https://github.com/Kiirani">github</a></li>
	<li><a href="http://stackoverflow.com/users/1487282/kiirani">stackoverflow</a></li>
	<li><a href="http://www.facebook.com/kiirani">facebook</a>
</ul>	

</nav>


<div id="main-content">

	<nav class="pagination">
  
  	
    <a href="/" class="newer">Newer</a>
    
  

  

  
    
  <span class="page_number ">2 of 3</span>
  
  

  
    <a href="/page3" class="older ">older</a>
  
</nav>




<section id="posts">


<article class="post">
	<header>
		<h2> <a href="/2013/03/22/tesseract-pdf.html">Using Tesseract OCR with PDF scans</a> </h2>
		<span>posted 22 March 2013</span>
	</header>

	<p>We&#8217;re at the very beginning of a push to create a centralised repository of company knowledge: a place where new employees <strong>know</strong> they can go to find up to date, definitive information.</p>

<p>Just finding a place to start is a daunting task. Which is how I found myself retrieving a dog-eared photocopy of an introductory document from my folder in my cubby in the office I rarely visit.</p>

<p>I&#8217;ve been keeping this document around &#8220;just in case&#8221; for about a year and a half now, but I finally have a use for it: it&#8217;s the perfect lightweight overview from which to spawn a dozen or so wiki pages &#8211; just enough to get our knowledgable staff interested in contributing to and maintaining the information.</p>

<p>We&#8217;re not sure where the master digital copy of this document got to. It obviously existed a couple of years ago, when the version I photocopied mine from was first printed. Equally obviously, it doesn&#8217;t exist now.</p>

<p>While fruitlessly searching through our digital archives, the boss had a marvellous idea: if we can&#8217;t find it, we can get the document scanned and OCR&#8217;d instead</p>

<p><strong>Challenge accepted!</strong> I know how to scan and OCR a document. Our photocopier even has a document feeder. I can probably work this out in the next half hour or so.</p>

<p>The photocopier emailed me a lovely 13 page PDF, ready to run through <code>tesseract</code>.</p>

<p>Wait, no, that doesn&#8217;t sound right.</p>

<pre><code>% tesseract file.pdf output
Tesseract Open Source OCR Engine v3.02.02 with Leptonica
Error in pixReadStream: Unknown format: no pix returned
Error in pixRead: pix not read
Unsupported image type.</code></pre>

<p><strong>Tesseract doesn&#8217;t read PDFs.</strong></p>

<p>I&#8217;m sure I used it successfully on a TIFF last time, though. <br /> Imagemagick can probably convert that for me.</p>

<pre><code>% convert file.pdf file.tiff
% tesseract file.tiff output
Tesseract Open Source OCR Engine v3.02.02 with Leptonica
Error in pixReadFromTiffStream: can&#39;t handle bpp &gt; 32
Error in pixReadStreamTiff: pix not read
Error in pixReadStream: tiff: no pix returned
Error in pixRead: pix not read
Unsupported image type.</code></pre>

<p>Mm, nope. Some slight issues with colour TIFF images there.</p>

<p>Let&#8217;s make that an 8 bit TIFF instead.</p>

<pre><code>% convert file.pdf -depth 8 file.tiff
% tesseract file.tiff output
Tesseract Open Source OCR Engine v3.02.02 with Leptonica
Page 1 of 13
...</code></pre>

<p>Okay, now we&#8217;re getting somewhere. Unfortunately, the result is gibberish:</p>
<blockquote>
sugersm um wmcwankhmsmu n

mm, may k,mvnImq.\-nyv'r1nunr pcv:mclc"s mnsmmsluv uu5|t.eqweu\\me'v
mivvr ucnk‘ lm cenlmsu hcv We r_ mu; M. ZIVEV Var‘ wharwuh
</blockquote>
<p>Why? Well, because the TIFF file is barely readable.</p>

<p>There&#8217;s one last piece of wisdom here - the <a href='http://www.imagemagick.org/script/command-line-options.php#density'>standard resolution</a> for &#8220;convert&#8221; is 72dpi.</p>

<p>If we re-convert that at 300dpi, the result&#8230; actually comes out in English. Mostly.</p>

<pre><code>% convert -density 300 file.pdf -depth 8 file.tiff  
% tesseract file.tiff output</code></pre>

<p>So, <strong>steps to read a PDF document with tesseract</strong>:</p>

<ol>
<li>Convert the PDF document to something else</li>

<li>Make sure that something else is high resolution, and grayscale</li>

<li>Use tesseract to read the something else instead</li>
</ol>

<p>And all of that took about a half hour to work out.</p>

	<footer>
	<p>
		tags: <span class="tags"><a href="/tag/tesseract.html" rel="tag">tesseract</a>, <a href="/tag/ocr.html" rel="tag">ocr</a>, <a href="/tag/imagemagick.html" rel="tag">imagemagick</a></span>
		<a class="commentsLink"  href="/2013/03/22/tesseract-pdf.html#disqus_thread">view comments</a>
	</p>
	</footer>
</article>



<article class="post">
	<header>
		<h2> <a href="/2013/03/20/insomnia.html">insomnia</a> </h2>
		<span>posted 20 March 2013</span>
	</header>

	<p>Spending another night unable to sleep; took my pills, read a book, lay down, relaxed.</p>

<p>Eventually become frustrated. Lying in bed tossing and turning isn&#8217;t productive.</p>

<p>I get up, fiddle with my website, write some documentation, think about work tomorrow.</p>

<p>Manage some semblance of exhaustion by 6am&#8230; Maybe enough to drop off before 7&#8230; I can&#8217;t afford to wake up at one in the afternoon after only 6 hours of sleep&#8230; again&#8230;</p>

<p>I like to think I&#8217;m having trouble sleeping because I&#8217;m stressed, but then lorazepam, glorious cure of anxiety and creator of unconsciousness, lorazepam doesn&#8217;t work. I don&#8217;t know how to deal with this.</p>

	<footer>
	<p>
		tags: <span class="tags"><a href="/tag/life.html" rel="tag">life</a>, <a href="/tag/sleep.html" rel="tag">sleep</a></span>
		<a class="commentsLink"  href="/2013/03/20/insomnia.html#disqus_thread">view comments</a>
	</p>
	</footer>
</article>



<article class="post">
	<header>
		<h2> <a href="/2013/03/18/pacman-dependencies.html">(pacman) resolving missing dependencies</a> </h2>
		<span>posted 18 March 2013</span>
	</header>

	<p>I was in dependency hell on my last system update. I&#8217;m impatient, so I resolve dependency hell by bypassing dependency checks altogether.</p>

<p>Having successfully run <code>pacman -Sudd</code>, I&#8217;m now stuck with some missing dependencies and a major headache every time I try to run things&#8230; Yay!</p>

<p>The official way to search your Arch system for missing dependencies is the <code>testdb</code> command.</p>

<p><code>testdb</code> is useless for piping into pacman: it doesn&#8217;t have any special piped output, nor does it have a linear option like pactree (&#9829; pactree -l).</p>

<p>The resulting output is a mess of human readableness</p>

<pre><code>missing dependency for blender : openshadinglanguage
missing dependency for gnome-settings-daemon : ibus
missing dependency for lib32-mesa : lib32-libdrm
missing dependency for lib32-mesa : lib32-systemd
missing dependency for libpurple : farstream-0.1
missing dependency for mga-dri : mesa-libgl
missing dependency for openimageio : intel-tbb
missing dependency for workrave : gtkmm3
missing dependency for workrave : python2-cheetah</code></pre>

<p>Fortunately this is pretty easily cleaned up with a little bit of commandline magic We can cut this at &#8221;:&#8221;, grab the second half, and then trim off the leading whitespace.</p>
<div class='highlight'><pre><code class='bash'><span class='c'># testdb | cut -d: -f2 | sed s&quot;/ //g&quot;  </span>
openshadinglanguage
ibus
lib32-libdrm
lib32-systemd
farstream-0.1
mesa-libgl
intel-tbb
gtkmm3
python2-cheetah
</code></pre></div>
<p>This list can then be piped into pacman :</p>
<div class='highlight'><pre><code class='bash'><span class='c'># testdb | cut -d: -f2 | sed s&quot;/ //g&quot; | pacman -S -</span>
</code></pre></div>
<p>But for me, this doesn&#8217;t end here.</p>

<p>The reason I ran an -Sdd in the first place was I have some weird dependency conflicts between mesa-libgl and my nvidia drivers, and I can&#8217;t be bothered fixing those right now.</p>

<p>I could do a basic <code>| grep -v &quot;mesa-libgl&quot;</code>, but I thought it would be nice to go through each package and check that it and its dependencies won&#8217;t cause me any problems</p>
<div class='highlight'><pre><code class='bash'><span class='k'>for </span>line in <span class='sb'>`</span>testdb | cut -d: -f2 | sed s<span class='s2'>&quot;/ //g&quot;</span><span class='sb'>`</span>; <span class='k'>do </span>
<span class='k'>    </span>pacman -S <span class='nv'>$line</span>
<span class='k'>done</span>;
</code></pre></div>
<p>Okay, so, I&#8217;m still left in dependency hell with libgl, but most of my system functions and my bash-fu is stronger.</p>

	<footer>
	<p>
		tags: <span class="tags"><a href="/tag/bash.html" rel="tag">bash</a>, <a href="/tag/arch.html" rel="tag">arch</a>, <a href="/tag/pacman.html" rel="tag">pacman</a></span>
		<a class="commentsLink"  href="/2013/03/18/pacman-dependencies.html#disqus_thread">view comments</a>
	</p>
	</footer>
</article>



<article class="post">
	<header>
		<h2> <a href="/2013/03/16/bad-comments-are-bad.html">bad comments are bad</a> </h2>
		<span>posted 16 March 2013</span>
	</header>

	<p>My local apache install has some issues. For one thing, it&#8217;s completely ignoring everything I put in .htaccess.</p>

<p>My first mistake was going into my main configuration to try and track this down.<br /> My second mistake was reading the comments I&#8217;ve left in this file.</p>

<p>I think it might be time to consider reconfiguring apache.</p>
<div class='highlight'><pre><code class='bash'><span class='c'># Wtf? This is redundant..</span>

<span class='c'># This is going to get in the way in later life :)</span>

<span class='c'># For compatibility with my old setup</span>
<span class='c'># Needs to be changed lol</span>

<span class='c'># Icons for apache generated pages. Should be replaced soon</span>

<span class='c'># For the love of god, turn this down after use</span>

<span class='c'># Rewrite rules SHOULD go into .htaccess files, but nvm for now</span>

<span class='c'># Commented until I can migrate script to modern python</span>

<span class='c'># Should php ever break...</span>

<span class='c'># More magic?</span>

<span class='c'># Indexes are globally disabled, but oh well, need to configure somewhere.</span>
</code></pre></div>

	<footer>
	<p>
		tags: <span class="tags"></span>
		<a class="commentsLink"  href="/2013/03/16/bad-comments-are-bad.html#disqus_thread">view comments</a>
	</p>
	</footer>
</article>



<article class="post">
	<header>
		<h2> <a href="/2012/07/16/cli-package-list-processing.html">Some commandline package list processing</a> </h2>
		<span>posted 16 July 2012</span>
	</header>

	<p>This seems to come up a lot for me. I&#8217;m sure I&#8217;m the only person in the world, though.</p>

<p>I have two problems:</p>

<p>1) Every now and then, I get the urge to reinstall (nearly) every package on my system</p>

<p>2) I&#8217;ve got a pile of explicitly installed packages which are not in the package repositories</p>

<p>The solution to problem number one under arch is a simple pacman -S $(pacman -Qq). Easy as.<br /> Of course, all of the packages from problem number two get in the way of this. There&#8217;s no clear way around the problem, so here&#8217;s some text processing fun:</p>
<div class='highlight'><pre><code class='bash'><span class='c'># pacman -Qq &gt; all</span>
<span class='c'># pacman -Qm | cut -d\  -f 1 &gt; bad</span>
<span class='c'># grep -vf bad all &gt; good</span>
<span class='c'># pacman -S - &lt; good</span>
</code></pre></div>

	<footer>
	<p>
		tags: <span class="tags"><a href="/tag/bash.html" rel="tag">bash</a>, <a href="/tag/arch.html" rel="tag">arch</a>, <a href="/tag/pacman.html" rel="tag">pacman</a></span>
		<a class="commentsLink"  href="/2012/07/16/cli-package-list-processing.html#disqus_thread">view comments</a>
	</p>
	</footer>
</article>



</section>

<nav class="pagination">
  
  	
    <a href="/" class="newer">Newer</a>
    
  

  

  
    
  <span class="page_number ">2 of 3</span>
  
  

  
    <a href="/page3" class="older ">older</a>
  
</nav>




<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'kiirani'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script> 


</div>


<footer id="main-footer">




<p style="text-align:center"> <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img style="vertical-align:middle" alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a> <a href="https://github.com/Kiirani/kiirani.github.com">source code</a>

<p>
site by Kiirani, use only as directed <br>
design inspired by <a href="https://github.com/orderedlist/minimal">"minimal"</a>
</footer>

</body>


</html>
